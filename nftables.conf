flush ruleset

table inet filter {
  chain input   { type filter hook input   priority 0; policy accept; }
  chain output  { type filter hook output  priority 0; policy accept; }

  chain forward {
    type filter hook forward priority 0; policy drop;

    # Always allow reply traffic back in
    ct state established,related accept

    # Allow containers on docker0 and any Compose bridge br-*
    iifname { "docker0", "br-*" } accept
    oifname { "docker0", "br-*" } ct state established,related accept
  }
}

# Keep NAT simple and explicit for both default bridge and Compose bridges
table ip nat {
  chain postrouting {
    type nat hook postrouting priority 100; policy accept;
    ip saddr 172.17.0.0/16 oifname "enp74s0" masquerade
    ip saddr 172.18.0.0/16 oifname "enp74s0" masquerade
  }
}

